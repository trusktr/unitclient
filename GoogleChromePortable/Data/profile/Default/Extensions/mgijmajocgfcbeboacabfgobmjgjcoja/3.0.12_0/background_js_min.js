/* Copyright 2011 Google Inc. All Rights Reserved. */ (function(){var b=!0,j=null,k=!1,l=l||{};LEAPFROG_MODE&&(tblf.module.provide("tblf.translationary"),tblf.D=l);l.w=100;l.c="dict-chrome-ex";l.d=k;l.v=RegExp("<[^>]*>","g");l.z=RegExp("[<>]","g");l.k="\" ' ( ) , - . / 1 2 2012 : ? a about and are as be but com for from have i in is it like may more my next not of on search that the this to was when with you your".split(" ");l.A="http://www.google.com/dictionary";l.options={};l.C=0;l.f=-1;l.e=-1;
l.u=function(a){a=a.replace(l.v,"");a=a.replace(l.z,"");return a=a.substring(0,l.w).toLowerCase()};l.contains=function(a,d){for(var c=0,e=a.length;c<e;c++)if(d==a[c])return b;return k};l.a=function(a){return JSON.stringify(a,j,"  ")};l.s=function(){l.options=JSON.parse(window.localStorage.options)};l.p=function(a,d,c){if(a.type=="initialize"){a={instanceId:l.C++,leapfrogServerUrl:LEAPFROG_MODE?LEAPFROG_SERVER_URL:""};c(a)}};
l.q=function(a,d,c){if(a.type=="options")if(LEAPFROG_MODE){a={language:"en"};a.popupDblclick=tblf.localStorage.getItem("pref-translationary-enable");a.popupDblclickKey="none";a.popupSelect="false";a.enableHttps=tblf.localStorage.getItem("pref-translationary-enable-https");c({options:a})}else c({options:l.options})};
l.o=function(a,d,c){if(!(a.type!="fetch_raw"&&a.type!="fetch_html")){_gaq&&_gaq.push(["_trackEvent","lookup",a.type]);l.f!=-1&&l.e!=a.instanceId&&chrome.tabs.sendRequest(l.f,{type:"hide",instanceId:l.e});if(a.type=="fetch_raw"){l.f=d.tab.id;l.e=a.instanceId}else{l.f=-1;l.e=-1}var d=l.u(a.query),e={request:a,sanitizedQuery:d,dictResponse:j,translateResponse:j,numResponses:0,callback:c},c="pr,de";a.type=="fetch_html"&&(c="pr,de,sy");google.language.define(d,l.options.language,l.options.language,function(a){l.b(a,
"dict",e)},{restricts:c});if(!LEAPFROG_MODE){l.options.language!="en"&&google.language.define(d,"en","en",function(a){l.b(a,"enDict",e)},{restricts:c});l.t(d,function(a){l.b(a,"translate",e)});chrome.tabs.getSelected(j,function(a){var c=window.setTimeout(function(){l.b({lang:"unknown"},"tabLang",e)},800);chrome.tabs.detectLanguage(a.id,function(a){window.clearTimeout(c);l.b({lang:a},"tabLang",e)})})}}};
l.t=function(a,d){var c=new XMLHttpRequest;c.open("GET","https://clients5.google.com/translate_a/t?client="+l.c+"&sl=auto&tl="+l.options.language+"&q="+a,b);c.onreadystatechange=function(){if(c.readyState==4)try{d(JSON.parse(c.responseText))}catch(a){d(j)}};c.send()};l.l=function(a){return a=="he"?"iw":a};
l.b=function(a,d,c){if(d=="dict")c.dictResponse=a;else if(d=="enDict")c.enDictResponse=a;else if(d=="translate")c.translateResponse=a;else{if(c.tabLang)return;c.tabLang=l.l(a.lang)}a=3;l.options.language!="en"&&(a=4);LEAPFROG_MODE&&(a=1);c.numResponses++;if(c.numResponses==a){d=a=l.h(c.dictResponse);l.options.language!="en"&&(d=l.h(c.enDictResponse));var e=l.i(c.translateResponse,b);if(l.d){console.log("dictResponse:");console.log(l.a(c.dictResponse));console.log("definitionObj:");console.log(l.a(a));
console.log("enDictResponse:");console.log(l.a(c.enDictResponse));console.log("enDefinitionObj:");console.log(l.a(d));console.log("translateResponse:");console.log(l.a(c.translateResponse));console.log("translationObj:");console.log(l.a(e))}var f=j;if(c.translateResponse&&c.translateResponse.ld_result)if(f=c.translateResponse.ld_result.srclangs)for(var g=0,i=f.length;g<i;g++)f[g]=f[g].toLowerCase();g=k;if(l.d&&e){console.log("srcLang="+e.srcLang.toLowerCase());console.log("tabLang="+c.tabLang.toLowerCase());
console.log("optLang="+l.options.language.toLowerCase())}if(!a||a.type!="licensedDef"){var i=l.options.language.toLowerCase(),h=e&&e.srcLang.toLowerCase()!=i;if(h&&f&&!l.contains(f,i)||!a&&h)g=b}f=g?"translation":"definition";!a&&!e&&(f="none");_gaq&&_gaq.push(["_trackEvent","lookup","type_"+f]);f="http://translate.google.com/translate_t?source="+l.c+"&sl=auto&tl="+l.options.language+"&q="+encodeURIComponent(c.sanitizedQuery);i="http://www.google.com/search?source="+l.c+"&defl="+l.options.language+
"&hl="+l.options.language+"&q="+encodeURIComponent(c.sanitizedQuery)+"&tbo=1&tbs=dfn:1";if(c.request.type=="fetch_html"){a="";a=g?l.n(c.translateResponse,f):l.m(c.dictResponse,i);a={eventKey:c.request.eventKey,sanitizedQuery:c.sanitizedQuery,html:a}}else{h=j;if(g&&e){h=e;h.moreUrl=f;d&&(d.audio&&e.srcLang.toLowerCase()=="en")&&(h.audio=d.audio)}else if(a){h=a;h.moreUrl=i}h&&!h.prettyQuery&&(h.prettyQuery=c.sanitizedQuery);a=k;if(!LEAPFROG_MODE&&(l.options.popupDblclick=="true"&&l.options.popupDblclickKey==
"none"||l.options.popupSelect=="true"&&l.options.popupSelectKey=="none")&&l.contains(l.k,c.sanitizedQuery))a=b;a={eventKey:c.request.eventKey,sanitizedQuery:c.sanitizedQuery,meaningObj:h,showOptionsTip:a};if(l.d){console.log("finalResponse:");console.log(l.a(a))}}c.callback(a)}};
l.i=function(a,d){if(!a||a.sentences[0].orig.toLowerCase()==a.sentences[0].trans.toLowerCase())return j;var c=a.sentences[0].orig.toLowerCase(),e=a.sentences[0].trans.toLowerCase(),f=e;if(d&&a.dict&&a.dict.length>0)for(var g=0,i=a.dict.length;g<i;g++)for(var h=a.dict[g],n=0,m=0,p=h.terms.length;m<p&&n<2;m++){var o=h.terms[m].toLowerCase();if(o.length>0&&o!=c&&o!=e){f=f+(", "+o);n++}}(c=window["gdx.LANG_MAP"][a.src.toLowerCase()])||(c=a.src);return{type:"translation",meaningText:f,attribution:"Translated from "+
c,srcLang:a.src}};l.g=function(a,d){for(var c=0,e;e=a[c];c++)if(e.type&&e.type==d&&e.text)return e.text;return""};l.j=function(a){if(!a||a.length==0)return j;for(var d=0,c;c=a[d];d++)for(var e=0,f;f=c.entries[e];e++)if(f.type=="meaning"&&f.terms&&f.terms.length>0){var g=l.g(f.terms,"text");if(g){a=l.g(c.terms,"sound").replace("http://","https://");return{prettyQuery:l.g(c.terms,"text"),meaningText:g,audio:a,attribution:l.g(f.terms,"url")}}}return j};
l.h=function(a){if(!a||a.error)return j;var d=l.j(a.primaries);if(d){d.attribution="";d.type="licensedDef"}else(d=l.j(a.webDefinitions))&&(d.type="webDef");return d};
l.n=function(a,d){var c=l.i(a,k);if(!c)return"";var c='<div class="translate-main">'+c.meaningText+'</div><div class="translate-attrib">('+c.attribution+")</div>",e="";if(a.dict&&a.dict.length>0)for(var e='<h3 class="dct-tl">Translated definitions</h3>',f=0,g=a.dict.length;f<g;f++){for(var i=a.dict[f],e=e+("<b>"+i.pos+"</b><ol>"),h=0,n=i.terms.length;h<n;h++){var m=i.terms[h];m.length>0&&(e=e+("<li>"+m+"</li>"))}e=e+"</ol>"}return c+e+('<br><div class="translate-powered">Powered by <a href="'+d+'" class="translate-link">Google Translate</a></div><br>')};
l.m=function(a,d){if(!a||a.error)return"";var c=google.language.dictionary.createResultHtml(a),e=document.createElement("div");e.innerHTML=c;for(var c=e.getElementsByTagName("a"),f=c.length-1;f>=0;f--){var g=c[f];if(g.innerText=="Google Dictionary"&&g.href.lastIndexOf(l.A,0)==0)g.href=d}return e.innerHTML};
l.r=function(a){var d={};d.language=a.language||"en";var c=function(a,c){return a=="true"||a=="false"?a:a==b?"true":a==k?"false":c};d.popupDblclick=c(a.popupDblclick,"true");d.popupSelect=c(a.popupSelect,"false");d.enableHttps=c(a.enableHttps,"true");d.popupDblclickKey=a.popupDblclickKey||"none";d.popupSelectKey=a.popupSelectKey||"ctrl";if(a.popupMode)if(a.popupMode=="popup_disabled")d.popupDblclick="false";else if(a.popupMode=="popup_key_ctrl"){d.popupDblclickKey="ctrl";d.popupSelect="true";d.popupSelectKey=
"ctrl"}return d};l.B=function(){dict_api.load("https://clients5.google.com?client="+l.c,"1","en");var a=window.localStorage.options,d={};a&&(d=JSON.parse(a));l.options=l.r(d);window.localStorage.options=JSON.stringify(l.options);if(l.d){console.log("gdx.options:");console.log(l.a(l.options))}chrome.extension.onRequest.addListener(l.p);chrome.extension.onRequest.addListener(l.q);chrome.extension.onRequest.addListener(l.o);window["gdx.updateOptions"]=l.s};LEAPFROG_MODE||l.B();})();
