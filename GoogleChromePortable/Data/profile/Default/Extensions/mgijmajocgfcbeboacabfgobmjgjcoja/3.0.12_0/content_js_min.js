/* Copyright 2011 Google Inc. All Rights Reserved. */ (function(){var d=!0,e=null,f=!1,j,k=function(a){return a.replace(/^\s+|\s+$/g,"")},o=function(a,b){return function(){return b.apply(a,arguments)}},p=function(){var a,b;self.pageYOffset?(a=self.pageXOffset,b=self.pageYOffset):document.documentElement&&document.documentElement.scrollTop?(a=document.documentElement.scrollLeft,b=document.documentElement.scrollTop):document.body&&(a=document.body.scrollLeft,b=document.body.scrollTop);return[a,b]},r=function(a){if(a&&a.tagName){var b=a.tagName.toLowerCase();if("input"==
b||"textarea"==b)return d}if(document.designMode&&"on"==document.designMode.toLowerCase())return d;for(;a;a=a.parentNode)if(a.isContentEditable)return d;return f},v=function(){var a=document.createElement("div");a.innerHTML="<br />";return 1==a.firstChild.nodeType},w=/[0-9A-Za-z]/,C=function(){chrome.extension.sendRequest({type:"initialize"},o(this,function(a){this.F=a.instanceId;this.D=a.leapfrogServerUrl;var a=document.createElement("div"),b=document.createElement("a");b.target="_blank";this.t=
a.cloneNode(f);this.p=document.createElement("audio");this.p.O=d;this.d=a.cloneNode(f);this.d.id="gdx-bubble-container";this.a=a.cloneNode(f);this.a.id="gdx-bubble-main";this.d.appendChild(this.a);this.b=a.cloneNode(f);this.b.id="gdx-bubble-query-container";this.q=a.cloneNode(f);this.q.id="gdx-bubble-query";this.l=a.cloneNode(f);this.l.id="gdx-bubble-audio-icon";var c=a.cloneNode(f);c.id="gdx-bubble-query-container-end";this.b.appendChild(this.q);this.b.appendChild(this.l);this.b.appendChild(c);this.i=
a.cloneNode(f);this.i.id="gdx-bubble-meaning";this.f=a.cloneNode(f);this.f.id="gdx-bubble-options-tip";this.f.innerHTML=x;this.j=a.cloneNode(f);this.j.id="gdx-bubble-more";this.h=b.cloneNode(f);this.j.appendChild(this.h);this.e=a.cloneNode(f);this.e.id="gdx-bubble-attribution";this.k=b.cloneNode(f);this.o=a.cloneNode(f);this.e.appendChild(this.k);this.e.appendChild(this.o);this.r=a.cloneNode(f);this.r.id="gdx-bubble-close";this.D&&(this.a.style.paddingLeft="27px",this.s=b.cloneNode(f),this.s.id="gdx-bubble-help",
this.s.href="http://www.google.com/support/toolbar/bin/answer.py?answer=191164",this.C=a.cloneNode(f),this.C.id="gdx-bubble-favicon");this.D&&this.a.appendChild(this.C);this.a.appendChild(this.r);this.D&&this.a.appendChild(this.s);this.a.appendChild(this.b);this.a.appendChild(this.i);this.a.appendChild(this.f);this.a.appendChild(this.e);this.a.appendChild(this.j);this.n=a.cloneNode(f);this.n.id="gdx-arrow-container";this.d.appendChild(this.n);this.H=z(a,"up");this.G=z(a,"down");this.B=o(this,this.M);
this.u=o(this,this.I);this.v=o(this,this.J);this.z=o(this,this.g);this.A=o(this,this.L);this.w=o(this,this.K);A("mouseup",this.B,document);A("click",this.u,document);A("dblclick",this.v,document);A("resize",this.z,window);A("keydown",this.A,document);A("click",o(this.p,this.p.play),this.l);chrome.extension.onRequest.addListener(B);chrome.extension.onRequest.addListener(this.w)}))},D=[],x="Tip: Didn't want this definition pop-up? Try setting a trigger key in <a href=\""+chrome.extension.getURL("options.html")+
'" target="_blank">Extension Options</a>.';j=C.prototype;j.m=0;j.t=e;j.p=e;j.d=e;j.a=e;j.b=e;j.q=e;j.l=e;j.i=e;j.f=e;j.r=e;j.j=e;j.s=e;j.C=e;j.h=e;j.e=e;j.k=e;j.o=e;j.n=e;j.H=e;j.G=e;j.c=e;j.B=e;j.u=e;j.v=e;j.z=e;j.A=e;j.w=e;
var A=function(a,b,c){document.addEventListener?c.addEventListener(a,b,f):c.attachEvent("on"+a,b)},E=function(a,b,c){document.removeEventListener?c.removeEventListener(a,b,f):c.detachEvent("on"+a,b)},F=function(a){E("mouseup",a.B,document);E("click",a.u,document);E("dblclick",a.v,document);E("resize",a.z,window);E("keydown",a.A,document);chrome.extension.onRequest.removeListener(B);chrome.extension.onRequest.removeListener(a.w);a.g()},z=function(a,b){var c=a.cloneNode(f),h=a.cloneNode(f),g=a.cloneNode(f);
c.id="gdx-arrow-main";"up"==b?(h.id="gdx-bubble-arrow-inner-up",g.id="gdx-bubble-arrow-outer-up"):(h.id="gdx-bubble-arrow-inner-down",g.id="gdx-bubble-arrow-outer-down");c.appendChild(h);c.appendChild(g);return c},H=function(a,b,c,h){this.left=a;this.top=b;this.right=c;this.bottom=h},I=function(a){a.a.style.left="0";a.a.style.top="0";var b=a.a.offsetWidth,c=a.a.offsetHeight,h=p(),g=[a.c.left+h[0],a.c.top+h[1]],i=a.c.bottom-a.c.top,q=g[0]+(a.c.right-a.c.left)/2,h=document.documentElement.offsetWidth+
document.body.scrollLeft,y=document.body.scrollLeft,m=q-b/2;m+b>h&&(m=h-b);m<y&&(m=y);var t=g[1]-c-12+2,n=g[1]+i+12-2;a:if(b=new H(m,t,m+b,t+c),b.top<document.body.scrollTop)b=f;else{for(var c=document.getElementsByTagName("embed"),G=document.getElementsByTagName("object"),u=p(),s=0,M=c.length+G.length;s<M;s++){var l=(s<c.length?c[s]:G[s-c.length]).getBoundingClientRect(),l=new H(l.left+u[0],l.top+u[1],l.right+u[0],l.bottom+u[1]);if(b.bottom>l.top&&l.bottom>b.top&&b.left<l.right&&l.left<b.right){b=
f;break a}}b=d}b?(n=a.G,n.style.top=g[1]-12+"px"):(t=n,n=a.H,b=0,"Microsoft Internet Explorer"==navigator.appName&&!(document.documentMode&&8<=document.documentMode)&&(b=16),n.style.top=g[1]+i-b+"px");g=q-12;n.style.left=g+"px";g-5>y&&g+24+5<h&&a.n.appendChild(n);a.a.style.top=t+"px";a.a.style.left=m+"px"};
C.prototype.N=function(a){if(a.eventKey==this.m){this.g();this.l.className="gdx-display-none";this.f.className="gdx-display-none";this.j.className="gdx-display-block";this.e.className="gdx-display-none";if(a.meaningObj){var b=a.meaningObj;this.b.className="gdx-display-block";this.q.innerHTML=b.prettyQuery;this.i.innerHTML=b.meaningText;b.audio&&(this.p.src=b.audio,this.l.className="gdx-display-block");this.h.href=b.moreUrl;this.h.innerHTML="More \u00bb";b.attribution&&("translation"==b.type?(this.o.innerHTML=
b.attribution,this.k.className="gdx-display-none",this.o.className="gdx-display-inline"):(this.t.innerHTML=b.attribution,b=this.t.getElementsByTagName("a")[0],this.k.href=b.href,this.k.innerHTML=b.innerHTML.replace("http://",""),this.k.className="gdx-display-inline",this.o.className="gdx-display-none"),this.e.className="gdx-display-block")}else this.b.className="gdx-display-none",this.i.innerHTML="No definition found.",this.h.href="http://www.google.com/search?q="+encodeURIComponent(a.sanitizedQuery),
this.h.innerHTML='Search the web for "'+a.sanitizedQuery+'" \u00bb';a.showOptionsTip&&(this.f.className="gdx-display-block");document.documentElement.appendChild(this.d);I(this)}};
var J=function(a,b){b==a.m&&(a.i.innerHTML="Dictionary is disabled for https pages.",a.h.href="http://www.google.com/support/toolbar/bin/answer.py?answer=191164",a.h.innerHTML="More information \u00bb",a.j.className="gdx-display-block",a.b.className="gdx-display-none",a.f.className="gdx-display-none",a.e.className="gdx-display-none",document.documentElement.appendChild(a.d),I(a))},K=function(a,b){var c=b.getBoundingClientRect();a.c=new H(c.left,c.top,c.right,c.bottom);if(window.screen.deviceXDPI&&
window.screen.logicalXDPI&&(c=window.screen.deviceXDPI/window.screen.logicalXDPI,1!=c))for(var h in a.c)a.c[h]=Math.round(a.c[h]/c)};C.prototype.g=function(){this.m++;var a=this.d;a&&a.parentNode&&a.parentNode.removeChild(a);for(a=this.n;a&&a.hasChildNodes();)a.removeChild(a.childNodes[0])};C.prototype.L=function(a){27==a.keyCode&&this.g()};
var L=function(a,b){return"none"==b||"alt"==b&&a.altKey||"ctrl"==b&&(-1!=window.navigator.platform.toLowerCase().indexOf("mac")?a.metaKey:a.ctrlKey)||"shift"==b&&a.shiftKey},N=function(a,b){for(var c=b.target||b.srcElement;c;c=c.parentNode)if(c==a.d)return d;return f},O=function(a,b,c,h){var g;"mouseup"==c?g="true"==h.popupSelect&&L(b,h.popupSelectKey):"dblclick"==c?g="true"==h.popupSelect&&L(b,h.popupSelectKey)?f:"true"==h.popupDblclick&&L(b,h.popupDblclickKey):(console.log("Unexpected eventType: "+
c),g=f);if(g){g=0;for(var i=D.length;g<i;g++)if(location.href.match(D[g]))return;if(!r(b.target||b.srcElement)&&v())if(g=e,i="",window.getSelection?(i=window.getSelection(),g=i.getRangeAt(0),i=k(i.toString())):document.selection&&(g=document.selection.createRange(),i=k(g.text)),i&&!(1==i.length&&127>=i.charCodeAt(0)&&!i.match(w))&&!("dblclick"==c&&-1!=i.indexOf(" "))){a.m++;var q=a.m;N(a,b)||K(a,g);"false"==h.enableHttps&&0==location.href.lastIndexOf("https",0)?J(a,q):(window.setTimeout(o(a,function(){if(q==
this.m){this.i.innerHTML="Searching...";this.b.className="gdx-display-none";this.f.className="gdx-display-none";this.j.className="gdx-display-none";this.e.className="gdx-display-none";document.documentElement.appendChild(this.d);I(this)}}),300),chrome.extension.sendRequest({type:"fetch_raw",eventKey:q,instanceId:a.F,query:i},o(a,a.N)))}}};
C.prototype.M=function(a){var b=a.target||a.srcElement;if(N(this,a))if(b==this.r)this.g();else{if("a"==b.tagName.toLowerCase())return}else this.g();chrome.extension.sendRequest({type:"options"},o(this,function(b){O(this,a,"mouseup",b.options)}))};C.prototype.I=function(a){var b=a.target||a.srcElement;N(this,a)&&"a"==b.tagName.toLowerCase()&&this.g()};C.prototype.J=function(a){chrome.extension.sendRequest({type:"options"},o(this,function(b){O(this,a,"dblclick",b.options)}))};
var B=function(a,b,c){"get_selection"==a.type&&(a=k(window.getSelection().toString()))&&c({selection:a})};C.prototype.K=function(a){"hide"==a.type&&a.instanceId==this.F&&this.g()};window._dictBubbleInstance&&F(window._dictBubbleInstance);window._gdxBubbleInstance&&F(window._gdxBubbleInstance);window.gdxBubbleInstance&&F(window.gdxBubbleInstance);if("undefined"==typeof tblf||"undefined"==typeof tblf.contentScriptUtil||tblf.contentScriptUtil.preventContentScripts()==f)window.gdxBubbleInstance=new C;})();
